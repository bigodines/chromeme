<script>

chrome.browserAction.onClicked.addListener(function(tab) {
    chrome.tabs.executeScript(null,
                           {file:"content_script.js",
                            allFrames: true}
                           );
   // attempt to fix smart_meme is not defined bug.
   chrome.tabs.executeScript(null,
                           {file:"smart_meme.js",
                            allFrames: true}
                           );
    chrome.browserAction.setPopup({popup:"popup.html"});
});

// bind, unbind and clear are simple commands
function simple_command(command) {
    chrome.tabs.getSelected(null, function(tab) {
        chrome.tabs.sendRequest(tab.id, {cmd: command});
    });
}

function post() {
    chrome.tabs.getSelected(null, function(tab) {
        chrome.tabs.sendRequest(tab.id, {cmd: "post"}, function(response) {
          if (!response.url) return false;
          try {
              makeRequest(response.url, response.data);
	  } catch (e) {
	      alert(e);
	  }
        });
    });
}

/**
    ajax galponero
*/
var makeRequest = function(url, data /*, method = 'POST' */) { 
    var method = 'POST', req;

    if (arguments.length > 2) {
        method = arguments[2];
    }

    req = new XMLHttpRequest();
    req.open('POST', url, true);
    req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

    req.send(data);

    req.onreadystatechange = function(evt) { 
	if (req.readyState === 4) {
	    if (req.status === 200) {
                chrome.tabs.create({'url':url, 'selected': true});
	    } else {
		alert("oops... didnt work as expected. thank god its not in production");// fuuuuu
	    }
	}
    };
};

</script>
